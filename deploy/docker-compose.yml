version: "3.9"

services:
  finance-backend:
    build:
      context: ..
      dockerfile: deploy/backend.Dockerfile
    extra_hosts:
      - "host.docker.internal:host-gateway"
    environment:
      APP_ENV: production
      HTTP_PORT: "8888"
      DB_DRIVER: "${DB_DRIVER}"
      DB_HOST: "${DB_HOST}"
      DB_PORT: "${DB_PORT}"
      DB_USER: "${DB_USER}"
      DB_PASSWORD: "${DB_PASSWORD}"
      DB_NAME: "${DB_NAME}"
      DB_SSLMODE: "${DB_SSLMODE}"
      DB_TIMEZONE: "${DB_TIMEZONE}"
      AUTH_USERNAME: "${AUTH_USERNAME}"
      AUTH_PASSWORD_HASH: "${AUTH_PASSWORD_HASH}"
      AUTH_JWT_SECRET: "${AUTH_JWT_SECRET}"
    expose:
      - "8888"
    restart: unless-stopped

  finance-frontend:
    build:
      context: ..
      dockerfile: deploy/frontend.Dockerfile
    ports:
      - "80:80"
    depends_on:
      - finance-backend
    restart: unless-stopped
